<!DOCTYPE html>
<html>
<head>
  <title>Kalendar & Gaji Interaktif Mobile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; font-size: 14px; margin: 5px; background: #f5f5f5; }
    h3 { text-align: center; color: #333; margin-bottom: 10px; font-size:16px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 15px; text-align: center; }
    th { border: 1px solid #ccc; padding: 6px; font-size: 12px; height: 30px; background: #e0e0e0; border-radius: 4px; }
    td { 
      border: 1px solid #ccc; 
      width: 14%; 
      min-width: 40px;
      min-height: 70px;
      position: relative;
      background-color: #f0f0f0; 
      transition: all 0.2s ease;
      border-radius: 6px;
      box-shadow: 1px 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      font-size: 14px;
      cursor: pointer;
      padding: 2px;
    }
    td:hover { transform: translateY(-2px); box-shadow: 3px 6px 10px rgba(0,0,0,0.2); }

    .date { font-weight: bold; font-size: 12px; margin-bottom: 2px; }

    .menu { 
      display: none; 
      position: absolute; 
      background: #fff; 
      border: 1px solid #aaa; 
      z-index: 100; 
      font-size: 14px;
      padding: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      border-radius: 6px;
      min-width: 120px;
    }
    .menu div { padding: 8px; cursor: pointer; border-radius: 4px; transition: background 0.2s; font-size:14px; }
    .menu div:hover { background: #f0f0f0; }

    /* Warna pilihan */
    .PAGI { background-color: #fff176; }      
    .MALAM { background-color: #424242; color: white; }  
    .OD { background-color: #ffffff; }        
    .KERJA_OD { background-color: #4caf50; color:white; } 
    .RD { background-color: #2196f3; color:white; }     
    .PH { background-color: #9c27b0; color:white; }     
    .OT_EXTRA { background-color: #ff9800; color:white; font-weight:bold; font-size:14px; }

    .output { margin-top: 10px; font-size: 14px; background: #fff; padding: 10px; border-radius: 6px; box-shadow: 1px 2px 4px rgba(0,0,0,0.15); }
    .output span { font-weight: bold; color: #1565c0; }
    input { width: 80px; padding: 4px; margin-right: 5px; font-size:14px; text-align:center; }
    .ot-input { width: 50px; font-size:14px; padding: 2px; margin-top:2px; text-align:center; }

    @media screen and (max-width: 480px){
      td { min-height: 90px; font-size:16px; }
      .menu div { font-size:16px; padding:10px; }
      input { width: 100px; font-size:16px; padding:4px; }
      .ot-input { width: 60px; font-size:16px; padding:3px; }
    }
  </style>
</head>
<body>

<h3>Kalendar Kerja & Gaji Automatik</h3>
<div>
  Basic: <input type="number" id="basic" value="2000"> 
  Elaun Dobi: <input type="number" id="elaunDobi" value="100">
</div>

<div id="calendar"></div>

<div class="output">
  <p>Jumlah Elaun Syif: <span id="elaunSyif">0</span></p>
  <p>Jumlah OT Normal: <span id="otNormal">0</span></p>
  <p>Jumlah PH: <span id="phTotal">0</span></p>
  <p>Jumlah Kerja OD: <span id="kerjaOD">0</span></p>
  <p>Jumlah OT Extra: <span id="otExtra">0</span></p>
  <p><b>Gaji Kasar: <span id="gajiKasar">0</span></b></p>
</div>

<script>
const calendarDiv = document.getElementById("calendar");
const daysInMonth = 30;
const startDay = 1;
const choices = ["PAGI","MALAM","OD","KERJA_OD","RD","PH","OT_EXTRA"];
const dayNames = ["Ahad","Isnin","Selasa","Rabu","Khamis","Jumaat","Sabtu"];

let table = document.createElement("table");
let headerRow = document.createElement("tr");
dayNames.forEach(day=>{
  let th = document.createElement("th");
  th.textContent = day;
  headerRow.appendChild(th);
});
table.appendChild(headerRow);

let row = document.createElement("tr");
for(let i=0;i<startDay;i++) row.appendChild(document.createElement("td"));

for(let d=1; d<=daysInMonth; d++){
  let cell = document.createElement("td");
  let span = document.createElement("span");
  span.className="date";
  span.innerHTML = d;
  cell.appendChild(span);

  // menu
  let menu = document.createElement("div");
  menu.className="menu";
  choices.forEach(c=>{
    let item=document.createElement("div");
    item.textContent=c.replace("_"," ");
    item.addEventListener("click", ()=>{
      cell.setAttribute("data-choice",c);
      choices.forEach(ch=>cell.classList.remove(ch));
      cell.classList.add(c);
      span.innerHTML=d+"<br>"+c.replace("_"," ");

      // OT EXTRA input inline
      if(c==="OT_EXTRA"){
        if(!cell.querySelector(".ot-input")){
          let input = document.createElement("input");
          input.type="number"; input.min="0"; input.value=0;
          input.className="ot-input";
          input.addEventListener("input", ()=>kiraGaji());
          cell.appendChild(input);
        }
      } else {
        let old = cell.querySelector(".ot-input");
        if(old) old.remove();
      }

      menu.style.display="none";
      kiraGaji();
    });
    menu.addEventListener("click", e=>e.stopPropagation());
    menu.appendChild(item);
  });
  cell.appendChild(menu);

  span.addEventListener("click", ()=>{
    document.querySelectorAll(".menu").forEach(m=>m.style.display="none");
    menu.style.display="block";
    menu.style.left="0px";
    menu.style.top="25px";
  });

  row.appendChild(cell);
  if((d+startDay)%7===0||d===daysInMonth){
    table.appendChild(row);
    row=document.createElement("tr");
  }
}
calendarDiv.appendChild(table);

// ===================== Kiraan Gaji =====================
function kiraGaji(){
  let basic=parseFloat(document.getElementById("basic").value)||0;
  let elaunDobi=parseFloat(document.getElementById("elaunDobi").value)||0;
  let elaunSyif=0, otNormal=0, phTotal=0, kerjaOD=0, otExtra=0;

  document.querySelectorAll("td").forEach(cell=>{
    let choice = cell.getAttribute("data-choice");
    if(!choice) return;

    if(choice==="PAGI"){ elaunSyif+=15; otNormal+=(basic+elaunDobi+elaunSyif)/26/8*1.5*3.5; }
    if(choice==="MALAM"){ elaunSyif+=20; otNormal+=(basic+elaunDobi+elaunSyif)/26/8*1.5*3.5; }
    if(choice==="PH"){ 
      let total=elaunSyif;
      phTotal+=(basic+elaunDobi+total)/26/8*3*3.5 + (basic+elaunDobi+total)/26*2;
    }
    if(choice==="KERJA_OD"){ let total=elaunSyif; kerjaOD+=(basic+elaunDobi+total)/26/8*1.5*11.5; }

    if(choice==="OT_EXTRA"){
      let input=cell.querySelector(".ot-input");
      let jam=parseFloat(input?.value)||0;
      let total=elaunSyif;
      otExtra+=(basic+elaunDobi+total)/26/8*1.5*jam;
    }
  });

  let gajiKasar=basic+elaunDobi+elaunSyif+otNormal+phTotal+kerjaOD+otExtra;
  document.getElementById("elaunSyif").textContent=elaunSyif.toFixed(2);
  document.getElementById("otNormal").textContent=otNormal.toFixed(2);
  document.getElementById("phTotal").textContent=phTotal.toFixed(2);
  document.getElementById("kerjaOD").textContent=kerjaOD.toFixed(2);
  document.getElementById("otExtra").textContent=otExtra.toFixed(2);

document.getElementById("gajiKasar").textContent=gajiKasar.toFixed(2);
}

// Event listener untuk input basic dan elaun dobi
document.getElementById("basic").addEventListener("input", kiraGaji);
document.getElementById("elaunDobi").addEventListener("input", kiraGaji);

// Tutup menu bila klik di luar
document.addEventListener("click", ()=> {
  document.querySelectorAll(".menu").forEach(m=>m.style.display="none");
});

// Kiraan awal supaya paparan tidak kosong
kiraGaji();
</script>

</body>
</html>